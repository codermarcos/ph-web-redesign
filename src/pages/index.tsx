
import Head from 'next/head';

import { QueryHookOptions, useQuery } from '@apollo/client';

import QUERY_POSTS from '@/graphql/queries/Posts.graphql';

import PostsList from '@/components/PostsList/PostsList.component';

/*
 * TODO: Implement SSR query to make server-side query with cache rehydration
 * https://medium.com/@ahsan-ali-mansoor/
 * apollo-client-cache-rehydration-in-next-js-d1d7c693699e
 *
 */

const RANKING_QUERY: QueryHookOptions = {
  fetchPolicy: 'cache-and-network',
  initialFetchPolicy: 'no-cache',
  variables: { order: 'RANKING' },
};

function Home() {

  const { data, fetchMore } = useQuery(QUERY_POSTS, RANKING_QUERY);

  const handleMore = () => {

    fetchMore({
      variables: {
        ...RANKING_QUERY.variables,
        after: data.posts.pageInfo.endCursor,
      },
    });

  };

  return (
    <>
      <Head>
        <title>
          Product Hunt
        </title>

        <meta
          content="Generated by create next app"
          name="description"
        />

        <meta
          content="width=device-width, initial-scale=1"
          name="viewport"
        />
      </Head>

      {
        data && data.posts
          ? (
            <PostsList
              {...data.posts}
              onLoadMore={handleMore}
            />
          )
          : null
      }
    </>
  );

}

export default Home;

